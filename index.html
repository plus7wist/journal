<h1 id="日志">日志</h1>
<h2 id="年-07月-20日-星期一-174745-cst">2020年 07月 20日 星期一 17:47:45 CST</h2>
<p>我想实现一个 MapInto trait，为所有可能的情况实现 iterator.map_into()，相当于 iterator.map(|item| item.into())，但是因为我的实现里 into 的结果类型不受泛型约束，所以没有成功。之后再考虑考虑怎么做。</p>
<p>昨天的 &amp;&amp;str 调用 ToString 导致迂回调用的问题，让我想起我已知的，将 &amp;str 转换成 String 的方法有三种：</p>
<ul>
<li><code>s.to_string()</code></li>
<li><code>s.to_owned()</code></li>
<li><code>s.into()</code></li>
</ul>
<p>我之前用第三种最多，因为打字少一点……现在看来，后两种都不太会产生第一种会出现的问题。</p>
<h2 id="年-07月-19日-星期日-150636-cst">2020年 07月 19日 星期日 15:06:36 CST</h2>
<p>Rust 的 &amp;str 实现了 ToString，str 也实现了 ToString，但前者是因为下面这一串实现。</p>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">impl</span> <span class="bu">Display</span> <span class="kw">for</span> <span class="dt">str</span> <span class="op">{}</span>
<span class="kw">impl</span>&lt;<span class="ot">&#39;_</span>, T&gt; <span class="bu">Display</span> <span class="kw">for</span> &amp;<span class="ot">&#39;_</span> T <span class="kw">where</span> T: <span class="bu">Display</span> + ?<span class="bu">Sized</span> <span class="op">{}</span>
<span class="kw">impl</span>&lt;T&gt; <span class="bu">ToString</span> <span class="kw">for</span> T <span class="kw">where</span> T: <span class="bu">Display</span> + ?<span class="bu">Sized</span> <span class="op">{}</span></code></pre></div>
<p>也就是最后依赖为 str 实现的 Display::fmt 来创造字符串的。相比较而言后者的效率自然会更高。</p>
<p>例如 s 是 &amp;&amp;str，那么 s.to_string() 会调用 &amp;str 的实现，为此写成 (*s).to_string()，调用 str 的实现更好一些。cargo clippy 可以找到第一种写法，给出一个警告。</p>
<h2 id="年-07月-18日-星期六-191654-cst">2020年 07月 18日 星期六 19:16:54 CST</h2>
<p>tmux 的默认 shell 受配置文件控制。例如要使用 fish，需要以下配置：</p>
<pre><code>set -g default-command /usr/local/bin/fish
set -g default-shell /usr/local/bin/fish</code></pre>
<p>注意，修改配置之后，需要关闭所有会话，新的配置才能起效。如果不在意其他会话的工作的话，可以用 tmux kill-server 杀死所有会话。</p>
<h2 id="年-07月-18日-星期六-175403-cst">2020年 07月 18日 星期六 17:54:03 CST</h2>
<p>date 工具的默认格式受 locale 影响。例如当前主要语言设置的是 C，想要输出简体中文日期时，首先编辑 /etc/locale.gen，打开 zh_CN.UTF-8 的开关。再运行 locale-gen 工具，最后用 LANG 环境变量控制 date。</p>
<pre><code>env LANG=zh_CN.UTF-8 date</code></pre>
<h2 id="年-07月-17日-星期五-195424-cst">2020年 07月 17日 星期五 19:54:24 CST</h2>
<p><code>dev-dependencies</code> 的依赖不会用在打包中，但会用在功能测试、示例和基准测试里。</p>
<pre><code>[dev-dependencies]
tempdir = &quot;0.3&quot;</code></pre>
<h2 id="年-07月-17日-星期五-175414-cst">2020年 07月 17日 星期五 17:54:14 CST</h2>
<pre><code>        Vec&lt;T&gt;      &amp;[T]    Box&lt;[T]&gt;
Vec&lt;T&gt;              &amp;x[..]  x.into_boxed_slice()
&amp;[T]    x.to_vec()          Box::new(*x)
Box&lt;T&gt;  x.to_vec()  &amp;*x</code></pre>
<h2 id="年-07月-17日-星期五-163229-cst">2020年 07月 17日 星期五 16:32:29 CST</h2>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">impl</span>&lt;T&gt; <span class="dt">Vec</span>&lt;T&gt; <span class="op">{</span>
    <span class="co">/// Shortens the vector, keeping the first len elements and dropping the</span>
    <span class="co">/// rest.</span>
    <span class="co">/// Note that this method has no effect on the allocated capacity of the</span>
    <span class="co">/// vector.</span>
    <span class="kw">pub</span> <span class="kw">fn</span> truncate(&amp;<span class="kw">mut</span> <span class="kw">self</span>, len: <span class="dt">usize</span>)
<span class="op">}</span></code></pre></div>
<h2 id="年-07月-17日-星期五-150111-cst">2020年 07月 17日 星期五 15:01:11 CST</h2>
<p>从 <code>&amp;[u32]</code> 中复制最后一个元素，得到 <code>Option&lt;u32&gt;</code>。</p>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> slice_last(slice: &amp;<span class="op">[</span><span class="dt">u32</span><span class="op">]</span>) -&gt; <span class="dt">Option</span>&lt;<span class="dt">u32</span>&gt; <span class="op">{</span>
    slice.last().copied()
<span class="op">}</span></code></pre></div>
<p>用到的方法是：</p>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">impl</span>&lt;T&gt; <span class="kw">for</span> &lt;T&gt; <span class="op">{</span>
    <span class="kw">pub</span> <span class="kw">fn</span> last(&amp;<span class="kw">self</span>) -&gt; <span class="dt">Option</span>&lt;&amp;T&gt;
<span class="op">}</span>

<span class="kw">impl</span> &lt;<span class="ot">&#39;_</span>, T&gt; <span class="dt">Option</span>&lt;&amp;<span class="ot">&#39;_</span> T&gt; <span class="kw">where</span> T: <span class="bu">Copy</span> <span class="op">{</span>
    <span class="kw">pub</span> <span class="kw">fn</span> copied(<span class="kw">self</span>) -&gt; <span class="dt">Option</span>&lt;T&gt;
<span class="op">}</span></code></pre></div>
